<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geschenke Planer</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel fÃ¼r JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* ZusÃ¤tzliche Animationen */
        @keyframes slideIn {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-in {
            animation: slideIn 0.3s ease-out forwards;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons als Komponenten (SVG Pfade) ---
        const Icon = ({ path, className, size = 24 }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width={size}
                height={size}
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
                className={className}
            >
                {path}
            </svg>
        );

        const Icons = {
            Gift: (props) => <Icon {...props} path={<><rect x="3" y="8" width="18" height="4" rx="1" /><path d="M12 8v13" /><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7" /><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.9 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5" /></>} />,
            Cake: (props) => <Icon {...props} path={<><path d="M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8" /><path d="M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1" /><path d="M2 21h20" /><path d="M7 8v2" /><path d="M12 8v2" /><path d="M17 8v2" /><path d="M7 4h.01" /><path d="M12 4h.01" /><path d="M17 4h.01" /></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></>} />,
            CheckCircle2: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10" /><path d="m9 12 2 2 4-4" /></>} />,
            Circle: (props) => <Icon {...props} path={<circle cx="12" cy="12" r="10" />} />,
            Plus: (props) => <Icon {...props} path={<><path d="M5 12h14" /><path d="M12 5v14" /></>} />,
            ShoppingBag: (props) => <Icon {...props} path={<><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" /><path d="M3 6h18" /><path d="M16 10a4 4 0 0 1-8 0" /></>} />,
            Euro: (props) => <Icon {...props} path={<><path d="M4 10h12" /><path d="M4 14h9" /><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2" /></>} />,
            User: (props) => <Icon {...props} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>} />,
            Share2: (props) => <Icon {...props} path={<><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" x2="15.42" y1="13.51" y2="17.49" /><line x1="15.41" x2="8.59" y1="6.51" y2="10.49" /></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>} />,
            AlertCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></>} />
        };

        // --- Hauptanwendung ---
        const GiftTrackerApp = () => {
            const [gifts, setGifts] = useState([]);
            const [isLoaded, setIsLoaded] = useState(false);
            const [notification, setNotification] = useState(null);

            const [formData, setFormData] = useState({
                item: '',
                recipient: '',
                occasion: 'christmas',
                price: '',
            });

            const [filter, setFilter] = useState('all');

            useEffect(() => {
                const loadData = () => {
                    const params = new URLSearchParams(window.location.search);
                    const sharedData = params.get('list');

                    if (sharedData) {
                        try {
                            const decoded = JSON.parse(decodeURIComponent(escape(atob(sharedData))));
                            if (Array.isArray(decoded)) {
                                setGifts(decoded);
                                showNotification('Geteilte Liste erfolgreich geladen!', 'success');
                                window.history.replaceState({}, document.title, window.location.pathname);
                                setIsLoaded(true);
                                return;
                            }
                        } catch (e) {
                            showNotification('Fehler beim Laden des Links.', 'error');
                        }
                    }

                    const saved = localStorage.getItem('giftIdeas');
                    if (saved) {
                        setGifts(JSON.parse(saved));
                    }
                    setIsLoaded(true);
                };

                loadData();
            }, []);

            useEffect(() => {
                if (isLoaded) {
                    localStorage.setItem('giftIdeas', JSON.stringify(gifts));
                }
            }, [gifts, isLoaded]);

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const addGift = (e) => {
                e.preventDefault();
                if (!formData.item || !formData.recipient) return;

                const newGift = {
                    id: Date.now(),
                    item: formData.item,
                    recipient: formData.recipient,
                    occasion: formData.occasion,
                    price: parseFloat(formData.price) || 0,
                    isBought: false,
                    createdAt: new Date().toISOString()
                };

                setGifts([newGift, ...gifts]);
                setFormData({
                    item: '',
                    recipient: '',
                    occasion: 'christmas',
                    price: '',
                });
            };

            const toggleStatus = (id) => {
                setGifts(gifts.map(gift =>
                    gift.id === id ? { ...gift, isBought: !gift.isBought } : gift
                ));
            };

            const deleteGift = (id) => {
                setGifts(gifts.filter(gift => gift.id !== id));
            };

            const generateShareLink = () => {
                try {
                    const jsonString = JSON.stringify(gifts);
                    const base64 = btoa(unescape(encodeURIComponent(jsonString)));
                    const url = `${window.location.origin}${window.location.pathname}?list=${base64}`;

                    navigator.clipboard.writeText(url);
                    showNotification('Link in die Zwischenablage kopiert!');
                } catch (e) {
                    showNotification('Liste ist zu lang zum Teilen.', 'error');
                }
            };

            const exportJSON = () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(gifts));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "geschenkideen.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            const totalCost = gifts.reduce((sum, gift) => sum + (gift.price || 0), 0);
            const boughtCount = gifts.filter(g => g.isBought).length;
            const totalCount = gifts.length;
            const progress = totalCount === 0 ? 0 : Math.round((boughtCount / totalCount) * 100);

            const filteredGifts = gifts.filter(gift => {
                if (filter === 'completed') return gift.isBought;
                if (filter === 'active') return !gift.isBought;
                return true;
            });

            return (
                <div className="min-h-screen p-4 md:p-8 font-sans">
                    <div className="max-w-2xl mx-auto space-y-6">

                        {notification && (
                            <div className={`fixed top-4 right-4 p-4 rounded-xl shadow-lg animate-in z-50 flex items-center gap-2 ${notification.type === 'error' ? 'bg-red-500 text-white' : 'bg-slate-900 text-white'
                                }`}>
                                {notification.type === 'error' ? <Icons.AlertCircle size={20} /> : <Icons.CheckCircle2 size={20} />}
                                {notification.message}
                            </div>
                        )}

                        <div className="text-center space-y-2 mb-8 relative">
                            <div className="inline-flex items-center justify-center p-3 bg-red-100 rounded-full mb-2">
                                <Icons.Gift className="w-8 h-8 text-red-600" />
                            </div>
                            <h1 className="text-3xl font-bold text-slate-900">Geschenke Planer</h1>
                            <p className="text-slate-500">Weihnachten & Geburtstage</p>

                            <div className="flex justify-center gap-2 mt-4">
                                <button onClick={generateShareLink} className="flex items-center gap-2 text-xs font-medium px-3 py-1.5 bg-white border border-slate-200 rounded-full text-slate-600 hover:bg-slate-50 transition-colors">
                                    <Icons.Share2 size={14} /> Link teilen
                                </button>
                                <button onClick={exportJSON} className="flex items-center gap-2 text-xs font-medium px-3 py-1.5 bg-white border border-slate-200 rounded-full text-slate-600 hover:bg-slate-50 transition-colors">
                                    <Icons.Download size={14} /> Backup
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center justify-center">
                                <span className="text-slate-400 text-sm font-medium mb-1">Budget</span>
                                <span className="text-2xl font-bold text-slate-800">{totalCost.toFixed(2)} â‚¬</span>
                            </div>
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center justify-center relative overflow-hidden">
                                <div className="absolute bottom-0 left-0 h-1 bg-green-500 transition-all duration-500" style={{ width: `${progress}%` }}></div>
                                <span className="text-slate-400 text-sm font-medium mb-1">Erledigt</span>
                                <span className="text-2xl font-bold text-slate-800">{boughtCount} / {totalCount}</span>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                            <h2 className="text-lg font-semibold mb-4 flex items-center gap-2">
                                <Icons.Plus className="w-5 h-5 text-indigo-500" />
                                Neue Idee hinzufÃ¼gen
                            </h2>
                            <form onSubmit={addGift} className="space-y-4">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="space-y-1">
                                        <label className="text-xs font-medium text-slate-500 ml-1">Geschenkidee</label>
                                        <div className="relative">
                                            <div className="absolute left-3 top-3 text-slate-400"><Icons.ShoppingBag size={16} /></div>
                                            <input type="text" name="item" placeholder="z.B. Wollsocken" value={formData.item} onChange={handleInputChange} className="w-full pl-9 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all" />
                                        </div>
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-xs font-medium text-slate-500 ml-1">FÃ¼r wen?</label>
                                        <div className="relative">
                                            <div className="absolute left-3 top-3 text-slate-400"><Icons.User size={16} /></div>
                                            <input type="text" name="recipient" placeholder="z.B. Mama" value={formData.recipient} onChange={handleInputChange} className="w-full pl-9 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all" />
                                        </div>
                                    </div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="space-y-1">
                                        <label className="text-xs font-medium text-slate-500 ml-1">Anlass</label>
                                        <div className="relative">
                                            <div className="absolute left-3 top-3 text-slate-400 pointer-events-none">
                                                {formData.occasion === 'christmas' ? <Icons.Gift size={16} /> : <Icons.Cake size={16} />}
                                            </div>
                                            <select name="occasion" value={formData.occasion} onChange={handleInputChange} className="w-full pl-9 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all appearance-none">
                                                <option value="christmas">ðŸŽ„ Weihnachten</option>
                                                <option value="birthday">ðŸŽ‚ Geburtstag</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-xs font-medium text-slate-500 ml-1">Preis (ca.)</label>
                                        <div className="relative">
                                            <div className="absolute left-3 top-3 text-slate-400"><Icons.Euro size={16} /></div>
                                            <input type="number" name="price" placeholder="0.00" step="0.01" value={formData.price} onChange={handleInputChange} className="w-full pl-9 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all" />
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" disabled={!formData.item || !formData.recipient} className="w-full bg-slate-900 hover:bg-slate-800 text-white font-medium py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                    HinzufÃ¼gen
                                </button>
                            </form>
                        </div>

                        <div className="flex p-1 bg-slate-200/50 rounded-lg">
                            {['all', 'active', 'completed'].map((f) => (
                                <button key={f} onClick={() => setFilter(f)} className={`flex-1 py-1.5 text-sm font-medium rounded-md transition-all ${filter === f ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>
                                    {f === 'all' && 'Alle'}
                                    {f === 'active' && 'Offen'}
                                    {f === 'completed' && 'Erledigt'}
                                </button>
                            ))}
                        </div>

                        <div className="space-y-3">
                            {filteredGifts.length === 0 ? (
                                <div className="text-center py-12 text-slate-400 bg-white rounded-2xl border border-dashed border-slate-200">
                                    <Icons.Gift className="w-12 h-12 mx-auto mb-3 opacity-20" />
                                    <p>Keine Geschenke gefunden.</p>
                                </div>
                            ) : (
                                filteredGifts.map((gift) => (
                                    <div key={gift.id} className={`group bg-white p-4 rounded-xl border transition-all hover:shadow-md flex items-center gap-4 ${gift.isBought ? 'border-green-100 bg-green-50/30' : 'border-slate-100'}`}>
                                        <button onClick={() => toggleStatus(gift.id)} className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-colors ${gift.isBought ? 'bg-green-500 text-white' : 'bg-slate-100 text-slate-300 hover:bg-slate-200'}`}>
                                            {gift.isBought ? <Icons.CheckCircle2 className="w-5 h-5" /> : <Icons.Circle className="w-5 h-5" />}
                                        </button>
                                        <div className="flex-1 min-w-0">
                                            <div className="flex items-center gap-2 mb-0.5">
                                                <h3 className={`font-semibold text-slate-800 truncate ${gift.isBought ? 'line-through text-slate-400' : ''}`}>{gift.item}</h3>
                                                <span className={`text-[10px] px-2 py-0.5 rounded-full font-medium flex items-center gap-1 ${gift.occasion === 'christmas' ? 'bg-red-50 text-red-600 border border-red-100' : 'bg-blue-50 text-blue-600 border border-blue-100'}`}>
                                                    {gift.occasion === 'christmas' ? <Icons.Gift size={10} /> : <Icons.Cake size={10} />}
                                                    {gift.occasion === 'christmas' ? 'Weihnachten' : 'Geburtstag'}
                                                </span>
                                            </div>
                                            <div className="flex items-center text-sm text-slate-500 gap-3">
                                                <span className="flex items-center gap-1"><Icons.User className="w-3 h-3" /> {gift.recipient}</span>
                                                {gift.price > 0 && <span className="flex items-center gap-1"><Icons.Euro className="w-3 h-3" /> {gift.price.toFixed(2)}</span>}
                                            </div>
                                        </div>
                                        <button onClick={() => deleteGift(gift.id)} className="p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors opacity-0 group-hover:opacity-100 focus:opacity-100" title="LÃ¶schen">
                                            <Icons.Trash2 className="w-5 h-5" />
                                        </button>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GiftTrackerApp />);
    </script>
</body>

</html>